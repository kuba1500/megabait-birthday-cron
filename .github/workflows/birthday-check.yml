name: Daily Birthday Check

on:
  schedule:
    - cron: '30 8 * * *'
  workflow_dispatch:

jobs:
  check-birthdays:
    runs-on: ubuntu-latest
    
    steps:
      - name: Call Birthday Check Function
        env:
          BASE44_API_KEY: ${{ secrets.BASE44_API_KEY }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          echo "üéÇ Starting birthday check..."
          echo "üìç Using API Key: ${BASE44_API_KEY:0:8}..."
          echo "üîë Using Secret: ${CRON_SECRET:0:8}..."
          
          response=$(curl -s -w "\n%{http_code}" -X POST \
            -H "Content-Type: application/json" \
            -H "api_key: $BASE44_API_KEY" \
            -d '{}' \
            "https://megabaitprivate.base44.app/api/apps/68a20f7a1cd7c118dc55744d/functions/triggerBirthdayCheck?token=$CRON_SECRET")
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo ""
          echo "Status Code: $http_code"
          echo "Response: $body"
          
          if [ "$http_code" -eq 200 ]; then
            echo "‚úÖ Birthday check completed successfully!"
          else
            echo "‚ùå Birthday check failed"
            exit 1
          fi
